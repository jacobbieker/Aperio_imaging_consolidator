# SU2C_pancreatic_cancer
 Designed and developed by Patrick Leyshock (leyshock@ohsu.edu) and Jacob Bieker (jacob@bieker.us)

 Script consolidates multiple .xls files (generated by Aperio image-analysis software) into one .xlsx workbook
   Input to script is multiple .xls files.  There is one .xls file per slide, ith one or more rows, each row
     corresponding to a region selected in the image

   Output is a single .xlsx worksheet
 Assumptions:
   1.  script is located in same directory as input files
   3.  input .xls files follow this naming convention:

             mouse_NN_slide_MM_stain_NAME.xls

       so for mouse 3, slide 2, stain BRDU, the file name should be:

             mouse_3_slide_2_stain_BRDU.xls

       Note that the delimitator between each component of the file name can be 
       any of the following: "_"
       
       Other valid names include:
       
              _3__2__BRDU.xls
              
      If the file name does not include the stain, the script will print out a warning and the relevant file name.

#   HOW TO USE
There are a few ways to use this script. 

Pre-requisites: R 3.1.0 or higher is installed on the computer being used
                Internet connection to install required libraries if they are not already installed

For Windows users: 

1. Download config.yml and aperio_consolidator.bat to your computer. 
2. Move all the .xls files from Aperio into one folder, renamed to follow the
above format
3. Place config and aperio_consolidator in the same folder as in the previous step
.. image:: https://github.com/jacobbieker/SU2C_pancreatic_cancer/Doc_images/Aperio_Docs_Shot_1.png
4. If necessary, change the names of the columns in config.yml by opening it up in a text editor
5. Double click on aperio_consolidator.bat to run the program
.. image:: SU2C_pancreatic_cancer/Doc_images/Aperio_Docs_Shot_2.PNG
6. A file called "consolidated_files.xlsx" should be created in the same folder, it contains the output of this script
.. image:: https://github.com/jacobbieker/SU2C_pancreatic_cancer/Doc_images/Aperio_Docs_Shot_3.png


For Mac OSX/Linux users:

1. Download config.yml and aperio_consolidator.sh to your computer. 
2. Move all the .xls files from Aperio into one folder, renamed to follow the
above format
3. Place config and aperio_consolidator in the same folder as in the previous step
4. If necessary, change the names of the columns in config.yml by opening it up in a text editor
5. Double click on aperio_consolidator.sh to run the program
6. A file called "consolidated_files.xlsx" should be created in the same folder, it contains the output of this script


# Testing

To test this program, open the testing subfolder. If necessary, edit the testConfig.yml file to change the testing
parameters. 

Run test.py to create dummy test files based off any input file. 

Currently has to be to manually checked against expected files (stored in expected)

Cases currently covered: 
- Large sets (>4000) of files
- Missing stain name -> Throws error with the file name

Cases needed to be covered:
- Naming convention errors besides just missing last section
